var dlbiliCur=async(QUALITY)=>{aj=(ur)=>{let ns=document.createElement('script');ns.setAttribute('type','text/javascript');ns.setAttribute('src',ur);document.getElementsByTagName('head')[0].appendChild(ns);};sf=(t)=>{let tt=t.replace(/\?.*/,'').split('.');return '.'+tt[tt.length-1];};fFn=(t)=>{return t.replace(/[\u002a\u002e\u003f\u0022\u003c\u003e\u007c\u002f\u005c]/g,'_');};dlu=async(ug,fn)=>{var sfx=sf(ug[0]);uo=window.URL||window.webkitURL||window;aE=document.createElementNS('http://www.w3.org/1999/xhtml','a');dlSingle=(url)=>{return new Promise((resolve)=>{let x=new XMLHttpRequest();x.open('GET',url,true);x.responseType='blob';x.onload=()=>{if(x.status===200)resolve(x.response);};x.send();})};dlFiles=async(uS)=>{var ar=[];for(let i=0;i<uS.length;i++){try{let dT=await dlSingle(uS[i]);ar.push({name:i.toString().padStart(uS.length.toString().length,'0')+sfx,blob:new Blob([dT])});}catch(e){}};return ar;};it=await dlFiles(ug);if(it.length-1){zp=new JSZip();it.forEach(item=>{if(item)zp.file(item.name,item.blob);});zp.generateAsync({type:'blob'}).then((cnt)=>{aE.href=uo.createObjectURL(cnt);aE.download=fn;aE.click();uo.revokeObjectURL(aE.href);});}else if(it.length){aE.href=uo.createObjectURL(it[0].blob);aE.download=fn+sfx;aE.click();uo.revokeObjectURL(aE.href);}else alert('下载失败！')};aj('https://stuk.github.io/jszip/dist/jszip.min.js');await new Promise((c)=>{$.ajax({url:'https://api.bilibili.com/x/player/playurl?cid='+cid+'&'+QUALITY+'&bvid='+bvid,dataType:'json',success:(t)=>{c(t.data.durl)}})}).then(d=>{gu=[];d.forEach(de=>{gu.push(de.url)});});dlu(gu,bvid+'_p'+p+' '+fFn(document.querySelector('span.tit').innerText));alert('已发送下载！请等待后台下载完成。');}